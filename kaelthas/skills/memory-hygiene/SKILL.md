# Skill: memory-hygiene

## Когда применять
Используй этот скилл, когда принц просит:
- почистить память,
- не терять идеи,
- проверить, что после compaction ничего не пропало,
- запустить недельную ротацию идей.

## Цель
Держать рабочую память компактной, но сохранять контент-идеи и историю изменений.

## Канонические файлы
- Идеи (источник истины): `ideas/IDEAS.md`
- Архив удалённых по TTL: `memory/archive/ideas-pruned/`
- Снимки перед изменением: `memory/archive/ideas-pruned/pre-clean/`
- Скрипт недельной очистки: `scripts/ideas-weekly-clean.sh`

## Процедура (обязательно)
1. Проверить наличие канонического файла идей и скрипта.
2. Запустить dry run (из любой директории):
   - `cd /home/openclaw/.openclaw/workspaces/kaelthas && bash scripts/ideas-weekly-clean.sh --dry-run 7`
3. Если dry run показывает `PRUNED=N`:
   - запустить реальный прогон: `cd /home/openclaw/.openclaw/workspaces/kaelthas && bash scripts/ideas-weekly-clean.sh 7`
   - подтвердить, что появился snapshot в `pre-clean/`
   - подтвердить, что архив появился в `ideas-pruned/`
   - убедиться, что `ideas/IDEAS.md` валиден по структуре секций.
4. Проверить cron-задачу weekly-clean:
   - job name: `Weekly ideas cleanup (7d TTL)`
   - schedule: воскресенье, 07:00 UTC.
5. Дать краткий отчёт принцу:
   - сколько идей удалено,
   - путь snapshot,
   - путь архива,
   - статус cron.

## Правила TTL
- Идея в блоке «Новые идеи» живёт максимум 7 дней.
- Старше 7 дней — перенос в архив при weekly-clean.
- Идеи не удаляются без следа.

## Валидация и stop-условия
- Если в файле не найден блок `## Новые идеи` — очистку не выполнять.
- Если у идеи нет валидной строки `_Дата добавления:_ YYYY-MM-DD` — очистку не выполнять.
- Если в блоке «Новые идеи» есть неожиданные строки вне формата идей — очистку не выполнять.
- В обоих случаях: отдать принцу alert и предложить ручную правку формата.

## Cron-политика
- Еженедельный запуск: воскресенье, 07:00 UTC.
- Job name: `Weekly ideas cleanup (7d TTL)`.

## Критерий успеха
- Рабочий контур памяти не разрастается бесконтрольно.
- Идеи не теряются: каждая удалённая запись имеет архивный след.
- После compaction агент знает, где искать идеи и архивы.
